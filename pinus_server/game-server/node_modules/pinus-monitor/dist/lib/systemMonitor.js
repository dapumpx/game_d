"use strict";
/**
 * Module dependencies
 */
Object.defineProperty(exports, "__esModule", { value: true });
const os = require("os");
const util = require("../utils/util");
const child_process_1 = require("child_process");
let info = {};
/**
 * get information of operating-system
 *
 * @param {Function} callback
 * @api public
 */
function getSysInfo(callback) {
    if (process.platform === 'win32')
        return;
    let reData = getBasicInfo();
    child_process_1.exec('iostat ', function (err, output) {
        if (!!err) {
            console.error('getSysInfo failed! ' + err.stack);
            callback(err, reData);
        }
        else {
            reData.iostat = format(output);
            callback(null, reData);
        }
    });
}
exports.getSysInfo = getSysInfo;
/**
 * analysis the disk i/o data,return a map contains kb_read,kb_wrtn ect.
 *
 * @param {String} data, the output of the command 'iostat'
 * @api private
 */
function format(data) {
    let time = util.formatTime(new Date());
    let output_array = data.toString().replace(/^\s+|\s+$/g, '').split(/\s+/);
    let output_values = [];
    for (let i = 0, counter = 0; i < output_array.length; i++) {
        if (!isNaN(output_array[i])) {
            output_values[counter] = parseFloat(output_array[i]);
            counter++;
        }
    }
    if (output_values.length > 0) {
        let output_hash = {
            date: time,
            disk: {
                kb_read: output_values[9],
                kb_wrtn: output_values[10],
                kb_read_per: output_values[7],
                kb_wrtn_per: output_values[8],
                tps: output_values[6]
            },
            cpu: {
                cpu_user: output_values[0],
                cpu_nice: output_values[1],
                cpu_system: output_values[2],
                cpu_iowait: output_values[3],
                cpu_steal: output_values[4],
                cpu_idle: output_values[5]
            }
        };
        return output_hash;
    }
}
/**
 * get basic information of operating-system
 *
 * @return {Object} result
 * @api private
 */
function getBasicInfo() {
    let result = {};
    for (let key in info) {
        result[key] = info[key]();
    }
    return result;
}
info.hostname = os.hostname;
info.type = os.type;
info.platform = os.platform;
info.arch = os.arch;
info.release = os.release;
info.uptime = os.uptime;
info.loadavg = os.loadavg;
info.totalmem = os.totalmem;
info.freemem = os.freemem;
info.cpus = os.cpus;
info.networkInterfaces = os.networkInterfaces;
info.versions = function () { return process.versions; };
info.arch = function () { return process.arch; };
info.platform = function () { return process.platform; };
info.memoryUsage = process.memoryUsage;
info.uptime = process.uptime;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3lzdGVtTW9uaXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9zeXN0ZW1Nb25pdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCx5QkFBeUI7QUFDekIsc0NBQXNDO0FBQ3RDLGlEQUFxQztBQUVyQyxJQUFJLElBQUksR0FBUSxFQUFFLENBQUM7QUFFbkI7Ozs7O0dBS0c7QUFFSCxvQkFBMkIsUUFBa0I7SUFDekMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7UUFBQyxNQUFNLENBQUM7SUFDekMsSUFBSSxNQUFNLEdBQVEsWUFBWSxFQUFFLENBQUM7SUFDakMsb0JBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxHQUFHLEVBQUUsTUFBTTtRQUNqQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMscUJBQXFCLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pELFFBQVEsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0IsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMzQixDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBWkQsZ0NBWUM7QUFFRDs7Ozs7R0FLRztBQUVILGdCQUFnQixJQUFZO0lBQ3hCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxL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