"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
let sequeue = require('seq-queue');
let queues = {};
exports.timeout = 3000;
/**
 * Add tasks into task group. Create the task group if it dose not exist.
 *
 * @param {String}   key       task key
 * @param {Function} fn        task callback
 * @param {Function} ontimeout task timeout callback
 * @param {Number}   timeout   timeout for task
 */
function addTask(key, fn, ontimeout, timeoutMs) {
    let queue = queues[key];
    if (!queue) {
        queue = sequeue.createQueue(exports.timeout);
        queues[key] = queue;
    }
    return queue.push(fn, ontimeout, timeoutMs);
}
exports.addTask = addTask;
/**
 * Destroy task group
 *
 * @param  {String} key   task key
 * @param  {Boolean} force whether close task group directly
 */
function closeQueue(key, force) {
    if (!queues[key]) {
        // ignore illeagle key
        return;
    }
    queues[key].close(force);
    delete queues[key];
}
exports.closeQueue = closeQueue;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFza01hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvY29tbW9uL21hbmFnZXIvdGFza01hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFZbkMsSUFBSSxNQUFNLEdBQTJCLEVBQUUsQ0FBQztBQUU3QixRQUFBLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFFMUI7Ozs7Ozs7R0FPRztBQUNILGlCQUF3QixHQUFXLEVBQUUsRUFBNkIsRUFBRSxTQUFxQixFQUFFLFNBQWlCO0lBQ3hHLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN4QixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDVCxLQUFLLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxlQUFPLENBQUMsQ0FBQztRQUNyQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFSRCwwQkFRQztBQUVEOzs7OztHQUtHO0FBQ0gsb0JBQTJCLEdBQVcsRUFBRSxLQUFjO0lBQ2xELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNmLHNCQUFzQjtRQUN0QixNQUFNLENBQUM7SUFDWCxDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6QixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QixDQUFDO0FBUkQsZ0NBUUMifQ==